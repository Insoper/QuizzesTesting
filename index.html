<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hasil Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .badge {
      font-size: 0.9em;
    }
    .bg-excellent { background-color: #28a745; }
    .bg-good { background-color: #17a2b8; }
    .bg-average { background-color: #ffc107; color: #000; }
    .bg-poor { background-color: #dc3545; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5>Hasil Quiz Interaktif</h5>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-md-4">
            <select class="form-select" id="categoryFilter">
              <option value="all">Semua Kategori</option>
            </select>
          </div>
          <div class="col-md-2">
            <button class="btn btn-primary w-100" id="filterBtn">Filter</button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Nama Siswa</th>
                <th>Kelas</th>
                <th>Kategori</th>
                <th>Nilai</th>
              </tr>
            </thead>
            <tbody id="resultsBody">
              <tr><td colspan="4" class="text-center">Pilih filter untuk melihat hasil</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SCRIPT_URL = 'YOUR_DEPLOYED_SCRIPT_URL';

    document.addEventListener('DOMContentLoaded', async () => {
      await loadCategories();
      document.getElementById('filterBtn').addEventListener('click', loadResults);
    });

    async function loadCategories() {
      try {
        const res = await fetch(`${SCRIPT_URL}?action=getCategories`);
        const { data } = await res.json();
        const select = document.getElementById('categoryFilter');
        
        data.forEach(cat => {
          select.innerHTML += `<option value="${cat}">${cat}</option>`;
        });
      } catch (error) {
        console.error("Gagal memuat kategori:", error);
      }
    }

    async function loadResults() {
      const category = document.getElementById('categoryFilter').value;
      const url = `${SCRIPT_URL}?action=getResults${category !== 'all' ? `&category=${category}` : ''}`;
      
      try {
        const res = await fetch(url);
        const { data } = await res.json();
        const tbody = document.getElementById('resultsBody');
        tbody.innerHTML = '';
        
        data.forEach(item => {
          const scoreClass = getScoreClass(item.Skor);
          tbody.innerHTML += `
            <tr>
              <td>${item.NamaSiswa || '-'}</td>
              <td>${item.KodeKelas || '-'}</td>
              <td>${item.Kategori || '-'}</td>
              <td><span class="badge ${scoreClass}">${item.Skor || '0'}</span></td>
            </tr>
          `;
        });
      } catch (error) {
        console.error("Gagal memuat hasil:", error);
      }
    }

    function getScoreClass(score) {
      score = parseInt(score) || 0;
      if (score >= 90) return 'bg-excellent';
      if (score >= 80) return 'bg-good';
      if (score >= 65) return 'bg-average';
      return 'bg-poor';
    }
  </script>
</body>
</html>
